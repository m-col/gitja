<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>üêô gitserve - Add `gitserve -t` to output a plain config and base template.</title>
    <link rel="stylesheet" type="text/css" href="https://gitserve.mcol.xyz/style.css"/>
    <link rel="icon" type="image/png" href="https://gitserve.mcol.xyz/favicon.png"/>
  </head>

  <body>
    <a id="heada" href="https://gitserve.mcol.xyz">
      <header>
        <h1 id="title">gitserve</h1>
        <h2 id="desc">üêô Templated web page generator for your git repositories</h2>
      </header>
    </a>

    <div id="nav">
      <span id="url">git clone <a href="https://github.com/m-col/gitserve">https://github.com/m-col/gitserve</a></span>

      <span id="links">
        <a href="https://gitserve.mcol.xyz">Home</a> |
        <a href="https://gitserve.mcol.xyz/gitserve/log.html">Log</a> |
        <a href="https://gitserve.mcol.xyz/gitserve/tree.html">Files</a> |
        <a href="https://gitserve.mcol.xyz/gitserve/refs.html">Refs</a> |
        <a href="https://gitserve.mcol.xyz/gitserve/file/README.rst.html">Readme</a> |
        <a href="https://gitserve.mcol.xyz/gitserve/file/LICENSE.html">License</a>
      </span>

      <p id="tag">
        Docs built @ <a href="https://gitserve.mcol.xyz/gitserve/commit/2b5e93377bab6ebf38f5e06cebdd49418093d9de.html">2b5e933</a>
      </p>
    </div>

    <div id="content">
      <pre><b>Commit</b> <a href="https://gitserve.mcol.xyz/gitserve/commit/edff811793f7c3f487c6373445b44149fc3385e5.html">edff811793f7c3f487c6373445b44149fc3385e5</a>
<b>Parent:</b> <a href="https://gitserve.mcol.xyz/gitserve/commit/4952859082289144fbf3bb7f6b0bf0b16f5e938f.html">4952859082289144fbf3bb7f6b0bf0b16f5e938f</a>
<b>Author:</b> mcol &lt;<a href="mailto:mcol@posteo.net">mcol@posteo.net</a>&gt;
<b>Date:</b> 2021-11-30 02:29:14 +0000
<b>Committer:</b> mcol &lt;<a href="mailto:mcol@posteo.net">mcol@posteo.net</a>&gt;
<b>Committed:</b> 2021-11-30 02:29:14 +0000

Add `gitserve -t` to output a plain config and base template.

The assets are embedded into the compiled binary.
</pre><div class="diff">
  <p>
    <b>templates/base/style.css</b>
    <span class="status">Added</span>
  </p>

  @@ -0,0 +1 @@


  <pre><span class="add">+TODO
</span></pre></div><div class="diff">
  <p>
    <b>templates/base/index.html</b>
    <span class="status">Added</span>
  </p>

  @@ -0,0 +1 @@


  <pre><span class="add">+TODO
</span></pre></div><div class="diff">
  <p>
    <b>templates/README.rst</b>
    <span class="status">Modified</span>
  </p>

  @@ -14,6 +14,7 @@


  <pre><span class="def"> ============= ==========================================
</span><span class="def"> Template name Description
</span><span class="def"> ============= ==========================================
</span><span class="add">+base          This is placed into the current folder via ``gitserve -t``.
</span><span class="def"> docs          This is used for generating gitserve&apos;s docs website.
</span><span class="def"> stagit        This replicates much of stagit_&apos;s style.
</span><span class="def"> ============= ==========================================
</span></pre></div><div class="diff">
  <p>
    <b>src/config.dhall</b>
    <span class="status">Added</span>
  </p>

  @@ -0,0 +1,24 @@


  <pre><span class="add">+-- This is an example configuration file for gitserve.
</span><span class="add">+-- It uses the Dhall configuration language: dhall-lang.org
</span><span class="add">+
</span><span class="add">+-- You can list the git repositories here.
</span><span class="add">+-- These will be used to generate HTML.
</span><span class="add">+let repos = &quot;..&quot;
</span><span class="add">+
</span><span class="add">+let folders =
</span><span class="add">+    [ &quot;${repos}/gitserve&quot;
</span><span class="add">+    ]
</span><span class="add">+
</span><span class="add">+-- These are the configurable options that are used by gitserve.
</span><span class="add">+-- You may want to replace the relative paths for absolute paths.
</span><span class="add">+let config =
</span><span class="add">+    { repoPaths = folders
</span><span class="add">+    , templateDirectory = &quot;./template&quot;
</span><span class="add">+    , outputDirectory = &quot;./output&quot;
</span><span class="add">+    , host = &quot;http://localhost:8000&quot;
</span><span class="add">+    }
</span><span class="add">+
</span><span class="add">+-- Note: The host is available verbatim in templates.
</span><span class="add">+-- Port 8000 is appended here for easier testing with `python -m http.server`.
</span><span class="add">+
</span><span class="add">+in config
</span></pre></div><div class="diff">
  <p>
    <b>src/Main.hs</b>
    <span class="status">Modified</span>
  </p>

  @@ -1,4 +1,6 @@


  <pre><span class="add">+{-# LANGUAGE MultiWayIf #-}
</span><span class="def"> {-# LANGUAGE OverloadedStrings #-}
</span><span class="add">+{-# LANGUAGE TemplateHaskell #-}
</span><span class="def"> 
</span><span class="def"> module Main (
</span><span class="def">     main,
</span></pre>@@ -6,8 +8,13 @@


  <pre><span class="def"> 
</span><span class="def"> import Paths_gitserve (version)
</span><span class="def"> 
</span><span class="add">+import qualified Data.ByteString as B
</span><span class="add">+import qualified Data.ByteString.UTF8 as B
</span><span class="add">+import Data.FileEmbed (embedDir, embedFile)
</span><span class="def"> import Data.Version (showVersion)
</span><span class="def"> import qualified Options.Applicative as O
</span><span class="add">+import qualified System.Directory as D
</span><span class="add">+import System.FilePath (takeDirectory, (&lt;/&gt;))
</span><span class="def"> 
</span><span class="def"> import Config (getConfig)
</span><span class="def"> import Index (runIndex)
</span></pre>@@ -21,6 +28,7 @@


  <pre><span class="def">     { optConfig :: FilePath
</span><span class="def">     , optQuiet :: Bool
</span><span class="def">     , optForce :: Bool
</span><span class="add">+    , optTemplate :: Bool
</span><span class="def">     , optVersion :: Bool
</span><span class="def">     }
</span><span class="def"> 
</span></pre>@@ -45,6 +53,11 @@


  <pre><span class="def">                 &lt;&gt; O.help &quot;Force regeneration of all files.&quot;
</span><span class="def">             )
</span><span class="def">         &lt;*&gt; O.switch
</span><span class="add">+            ( O.long &quot;template&quot;
</span><span class="add">+                &lt;&gt; O.short &apos;t&apos;
</span><span class="add">+                &lt;&gt; O.help &quot;Create a template and config in the current folder.&quot;
</span><span class="add">+            )
</span><span class="add">+        &lt;*&gt; O.switch
</span><span class="def">             ( O.long &quot;version&quot;
</span><span class="def">                 &lt;&gt; O.short &apos;v&apos;
</span><span class="def">                 &lt;&gt; O.help &quot;Print the gitserve&apos;s version.&quot;
</span></pre>@@ -55,7 +68,7 @@


  <pre><span class="def">     O.execParser $
</span><span class="def">         O.info
</span><span class="def">             (opts O.&lt;**&gt; O.helper)
</span><span class="sub">-            ( O.progDesc &quot;üêô Templated web page generator for your git repositories&quot;
</span><span class="add">+            ( O.progDesc . B.toString $ $(embedFile &quot;description&quot;)
</span><span class="def">             )
</span><span class="def"> 
</span><span class="def"> {-
</span></pre>@@ -64,9 +77,38 @@


  <pre><span class="def"> main :: IO ()
</span><span class="def"> main = do
</span><span class="def">     options &lt;- parser
</span><span class="sub">-    if optVersion options
</span><span class="sub">-        then putStrLn $ &quot;Your gitserve version is: &quot; &lt;&gt; showVersion version
</span><span class="sub">-        else do
</span><span class="sub">-            conf &lt;- getConfig (optConfig options)
</span><span class="sub">-            env &lt;- loadEnv (optQuiet options) (optForce options) conf
</span><span class="sub">-            runIndex env =&lt;&lt; run env
</span><span class="add">+    if
</span><span class="add">+            | optVersion options -&gt;
</span><span class="add">+                putStrLn $ &quot;Your gitserve version is: &quot; &lt;&gt; showVersion version
</span><span class="add">+            | optTemplate options -&gt;
</span><span class="add">+                makeTemplate
</span><span class="add">+            | otherwise -&gt; do
</span><span class="add">+                conf &lt;- getConfig (optConfig options)
</span><span class="add">+                env &lt;- loadEnv (optQuiet options) (optForce options) conf
</span><span class="add">+                runIndex env =&lt;&lt; run env
</span><span class="add">+
</span><span class="add">+{-
</span><span class="add">+Put a base template and plain config into the current directory.
</span><span class="add">+-}
</span><span class="add">+makeTemplate :: IO ()
</span><span class="add">+makeTemplate = do
</span><span class="add">+    tExists &lt;- D.doesPathExist &quot;./template&quot;
</span><span class="add">+    cExists &lt;- D.doesPathExist &quot;./config.dhall&quot;
</span><span class="add">+    if
</span><span class="add">+            | tExists -&gt; putStrLn &quot;Failed - &apos;./template&apos; already exists.&quot;
</span><span class="add">+            | cExists -&gt; putStrLn &quot;Failed - &apos;./config.dhall&apos; already exists.&quot;
</span><span class="add">+            | otherwise -&gt; do
</span><span class="add">+                mapM_ (uncurry place) base
</span><span class="add">+                B.writeFile &quot;./config.dhall&quot; config
</span><span class="add">+  where
</span><span class="add">+    base :: [(FilePath, B.ByteString)]
</span><span class="add">+    base = $(embedDir &quot;templates/base&quot;)
</span><span class="add">+
</span><span class="add">+    config :: B.ByteString
</span><span class="add">+    config = $(embedFile &quot;src/config.dhall&quot;)
</span><span class="add">+
</span><span class="add">+    place :: FilePath -&gt; B.ByteString -&gt; IO ()
</span><span class="add">+    place path bytes = do
</span><span class="add">+        let path&apos; = &quot;template&quot; &lt;/&gt; path
</span><span class="add">+        D.createDirectoryIfMissing True . takeDirectory $ path&apos;
</span><span class="add">+        B.writeFile path&apos; bytes
</span></pre></div><div class="diff">
  <p>
    <b>gitserve.cabal</b>
    <span class="status">Modified</span>
  </p>

  @@ -21,10 +21,12 @@


  <pre><span class="def">   default-language:    Haskell2010
</span><span class="def">   build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5
</span><span class="def">                      , conduit
</span><span class="add">+                     , bytestring
</span><span class="def">                      , data-default
</span><span class="def">                      , dhall
</span><span class="def">                      , directory
</span><span class="def">                      , extra
</span><span class="add">+                     , file-embed
</span><span class="def">                      , filepath
</span><span class="def">                      , ginger &gt;= 0.10.3.0
</span><span class="def">                      , gitlib
</span></pre></div><div class="diff">
  <p>
    <b>Makefile</b>
    <span class="status">Modified</span>
  </p>

  @@ -14,7 +14,7 @@


  <pre><span class="def"> 
</span><span class="def"> .PHONY: format
</span><span class="def"> format: ## Auto-format the source code
</span><span class="sub">-	@fourmolu -m inplace src/*
</span><span class="add">+	@fourmolu -m inplace src/*.hs
</span><span class="def"> 
</span><span class="def"> .PHONY: install
</span><span class="def"> install: ## Install the compiled executable
</span></pre></div>    </div>
  </body>
</html>
